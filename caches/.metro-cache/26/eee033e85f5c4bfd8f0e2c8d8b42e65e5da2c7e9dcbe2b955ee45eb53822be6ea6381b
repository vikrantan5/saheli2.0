{"dependencies":[{"name":"../lib/constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":51,"index":51}}],"key":"waQwSI03ELOcvO96++KD0MVyAp4=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  var _constants = require(_dependencyMap[0], \"../lib/constants\");\n  class Push {\n    /**\n     * Initializes the Push\n     *\n     * @param channel The Channel\n     * @param event The event, for example `\"phx_join\"`\n     * @param payload The payload, for example `{user_id: 123}`\n     * @param timeout The push timeout in milliseconds\n     */\n    constructor(channel, event, payload = {}, timeout = _constants.DEFAULT_TIMEOUT) {\n      this.channel = channel;\n      this.event = event;\n      this.payload = payload;\n      this.timeout = timeout;\n      this.sent = false;\n      this.timeoutTimer = undefined;\n      this.ref = '';\n      this.receivedResp = null;\n      this.recHooks = [];\n      this.refEvent = null;\n    }\n    resend(timeout) {\n      this.timeout = timeout;\n      this._cancelRefEvent();\n      this.ref = '';\n      this.refEvent = null;\n      this.receivedResp = null;\n      this.sent = false;\n      this.send();\n    }\n    send() {\n      if (this._hasReceived('timeout')) {\n        return;\n      }\n      this.startTimeout();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: this.ref,\n        join_ref: this.channel._joinRef()\n      });\n    }\n    updatePayload(payload) {\n      this.payload = Object.assign(Object.assign({}, this.payload), payload);\n    }\n    receive(status, callback) {\n      var _a;\n      if (this._hasReceived(status)) {\n        callback((_a = this.receivedResp) === null || _a === void 0 ? void 0 : _a.response);\n      }\n      this.recHooks.push({\n        status,\n        callback\n      });\n      return this;\n    }\n    startTimeout() {\n      if (this.timeoutTimer) {\n        return;\n      }\n      this.ref = this.channel.socket._makeRef();\n      this.refEvent = this.channel._replyEventName(this.ref);\n      const callback = payload => {\n        this._cancelRefEvent();\n        this._cancelTimeout();\n        this.receivedResp = payload;\n        this._matchReceive(payload);\n      };\n      this.channel._on(this.refEvent, {}, callback);\n      this.timeoutTimer = setTimeout(() => {\n        this.trigger('timeout', {});\n      }, this.timeout);\n    }\n    trigger(status, response) {\n      if (this.refEvent) this.channel._trigger(this.refEvent, {\n        status,\n        response\n      });\n    }\n    destroy() {\n      this._cancelRefEvent();\n      this._cancelTimeout();\n    }\n    _cancelRefEvent() {\n      if (!this.refEvent) {\n        return;\n      }\n      this.channel._off(this.refEvent, {});\n    }\n    _cancelTimeout() {\n      clearTimeout(this.timeoutTimer);\n      this.timeoutTimer = undefined;\n    }\n    _matchReceive({\n      status,\n      response\n    }) {\n      this.recHooks.filter(h => h.status === status).forEach(h => h.callback(response));\n    }\n    _hasReceived(status) {\n      return this.receivedResp && this.receivedResp.status === status;\n    }\n  }\n  exports.default = Push;\n});","lineCount":113,"map":[[6,2,1,0],[6,6,1,0,"_constants"],[6,16,1,0],[6,19,1,0,"require"],[6,26,1,0],[6,27,1,0,"_dependencyMap"],[6,41,1,0],[7,2,2,15],[7,8,2,21,"Push"],[7,12,2,25],[7,13,2,26],[8,4,3,4],[9,0,4,0],[10,0,5,0],[11,0,6,0],[12,0,7,0],[13,0,8,0],[14,0,9,0],[15,0,10,0],[16,4,11,4,"constructor"],[16,15,11,15,"constructor"],[16,16,11,16,"channel"],[16,23,11,23],[16,25,11,25,"event"],[16,30,11,30],[16,32,11,32,"payload"],[16,39,11,39],[16,42,11,42],[16,43,11,43],[16,44,11,44],[16,46,11,46,"timeout"],[16,53,11,53],[16,56,11,56,"DEFAULT_TIMEOUT"],[16,82,11,71],[16,84,11,73],[17,6,12,8],[17,10,12,12],[17,11,12,13,"channel"],[17,18,12,20],[17,21,12,23,"channel"],[17,28,12,30],[18,6,13,8],[18,10,13,12],[18,11,13,13,"event"],[18,16,13,18],[18,19,13,21,"event"],[18,24,13,26],[19,6,14,8],[19,10,14,12],[19,11,14,13,"payload"],[19,18,14,20],[19,21,14,23,"payload"],[19,28,14,30],[20,6,15,8],[20,10,15,12],[20,11,15,13,"timeout"],[20,18,15,20],[20,21,15,23,"timeout"],[20,28,15,30],[21,6,16,8],[21,10,16,12],[21,11,16,13,"sent"],[21,15,16,17],[21,18,16,20],[21,23,16,25],[22,6,17,8],[22,10,17,12],[22,11,17,13,"timeoutTimer"],[22,23,17,25],[22,26,17,28,"undefined"],[22,35,17,37],[23,6,18,8],[23,10,18,12],[23,11,18,13,"ref"],[23,14,18,16],[23,17,18,19],[23,19,18,21],[24,6,19,8],[24,10,19,12],[24,11,19,13,"receivedResp"],[24,23,19,25],[24,26,19,28],[24,30,19,32],[25,6,20,8],[25,10,20,12],[25,11,20,13,"recHooks"],[25,19,20,21],[25,22,20,24],[25,24,20,26],[26,6,21,8],[26,10,21,12],[26,11,21,13,"refEvent"],[26,19,21,21],[26,22,21,24],[26,26,21,28],[27,4,22,4],[28,4,23,4,"resend"],[28,10,23,10,"resend"],[28,11,23,11,"timeout"],[28,18,23,18],[28,20,23,20],[29,6,24,8],[29,10,24,12],[29,11,24,13,"timeout"],[29,18,24,20],[29,21,24,23,"timeout"],[29,28,24,30],[30,6,25,8],[30,10,25,12],[30,11,25,13,"_cancelRefEvent"],[30,26,25,28],[30,27,25,29],[30,28,25,30],[31,6,26,8],[31,10,26,12],[31,11,26,13,"ref"],[31,14,26,16],[31,17,26,19],[31,19,26,21],[32,6,27,8],[32,10,27,12],[32,11,27,13,"refEvent"],[32,19,27,21],[32,22,27,24],[32,26,27,28],[33,6,28,8],[33,10,28,12],[33,11,28,13,"receivedResp"],[33,23,28,25],[33,26,28,28],[33,30,28,32],[34,6,29,8],[34,10,29,12],[34,11,29,13,"sent"],[34,15,29,17],[34,18,29,20],[34,23,29,25],[35,6,30,8],[35,10,30,12],[35,11,30,13,"send"],[35,15,30,17],[35,16,30,18],[35,17,30,19],[36,4,31,4],[37,4,32,4,"send"],[37,8,32,8,"send"],[37,9,32,8],[37,11,32,11],[38,6,33,8],[38,10,33,12],[38,14,33,16],[38,15,33,17,"_hasReceived"],[38,27,33,29],[38,28,33,30],[38,37,33,39],[38,38,33,40],[38,40,33,42],[39,8,34,12],[40,6,35,8],[41,6,36,8],[41,10,36,12],[41,11,36,13,"startTimeout"],[41,23,36,25],[41,24,36,26],[41,25,36,27],[42,6,37,8],[42,10,37,12],[42,11,37,13,"sent"],[42,15,37,17],[42,18,37,20],[42,22,37,24],[43,6,38,8],[43,10,38,12],[43,11,38,13,"channel"],[43,18,38,20],[43,19,38,21,"socket"],[43,25,38,27],[43,26,38,28,"push"],[43,30,38,32],[43,31,38,33],[44,8,39,12,"topic"],[44,13,39,17],[44,15,39,19],[44,19,39,23],[44,20,39,24,"channel"],[44,27,39,31],[44,28,39,32,"topic"],[44,33,39,37],[45,8,40,12,"event"],[45,13,40,17],[45,15,40,19],[45,19,40,23],[45,20,40,24,"event"],[45,25,40,29],[46,8,41,12,"payload"],[46,15,41,19],[46,17,41,21],[46,21,41,25],[46,22,41,26,"payload"],[46,29,41,33],[47,8,42,12,"ref"],[47,11,42,15],[47,13,42,17],[47,17,42,21],[47,18,42,22,"ref"],[47,21,42,25],[48,8,43,12,"join_ref"],[48,16,43,20],[48,18,43,22],[48,22,43,26],[48,23,43,27,"channel"],[48,30,43,34],[48,31,43,35,"_joinRef"],[48,39,43,43],[48,40,43,44],[49,6,44,8],[49,7,44,9],[49,8,44,10],[50,4,45,4],[51,4,46,4,"updatePayload"],[51,17,46,17,"updatePayload"],[51,18,46,18,"payload"],[51,25,46,25],[51,27,46,27],[52,6,47,8],[52,10,47,12],[52,11,47,13,"payload"],[52,18,47,20],[52,21,47,23,"Object"],[52,27,47,29],[52,28,47,30,"assign"],[52,34,47,36],[52,35,47,37,"Object"],[52,41,47,43],[52,42,47,44,"assign"],[52,48,47,50],[52,49,47,51],[52,50,47,52],[52,51,47,53],[52,53,47,55],[52,57,47,59],[52,58,47,60,"payload"],[52,65,47,67],[52,66,47,68],[52,68,47,70,"payload"],[52,75,47,77],[52,76,47,78],[53,4,48,4],[54,4,49,4,"receive"],[54,11,49,11,"receive"],[54,12,49,12,"status"],[54,18,49,18],[54,20,49,20,"callback"],[54,28,49,28],[54,30,49,30],[55,6,50,8],[55,10,50,12,"_a"],[55,12,50,14],[56,6,51,8],[56,10,51,12],[56,14,51,16],[56,15,51,17,"_hasReceived"],[56,27,51,29],[56,28,51,30,"status"],[56,34,51,36],[56,35,51,37],[56,37,51,39],[57,8,52,12,"callback"],[57,16,52,20],[57,17,52,21],[57,18,52,22,"_a"],[57,20,52,24],[57,23,52,27],[57,27,52,31],[57,28,52,32,"receivedResp"],[57,40,52,44],[57,46,52,50],[57,50,52,54],[57,54,52,58,"_a"],[57,56,52,60],[57,61,52,65],[57,66,52,70],[57,67,52,71],[57,70,52,74],[57,75,52,79],[57,76,52,80],[57,79,52,83,"_a"],[57,81,52,85],[57,82,52,86,"response"],[57,90,52,94],[57,91,52,95],[58,6,53,8],[59,6,54,8],[59,10,54,12],[59,11,54,13,"recHooks"],[59,19,54,21],[59,20,54,22,"push"],[59,24,54,26],[59,25,54,27],[60,8,54,29,"status"],[60,14,54,35],[61,8,54,37,"callback"],[62,6,54,46],[62,7,54,47],[62,8,54,48],[63,6,55,8],[63,13,55,15],[63,17,55,19],[64,4,56,4],[65,4,57,4,"startTimeout"],[65,16,57,16,"startTimeout"],[65,17,57,16],[65,19,57,19],[66,6,58,8],[66,10,58,12],[66,14,58,16],[66,15,58,17,"timeoutTimer"],[66,27,58,29],[66,29,58,31],[67,8,59,12],[68,6,60,8],[69,6,61,8],[69,10,61,12],[69,11,61,13,"ref"],[69,14,61,16],[69,17,61,19],[69,21,61,23],[69,22,61,24,"channel"],[69,29,61,31],[69,30,61,32,"socket"],[69,36,61,38],[69,37,61,39,"_makeRef"],[69,45,61,47],[69,46,61,48],[69,47,61,49],[70,6,62,8],[70,10,62,12],[70,11,62,13,"refEvent"],[70,19,62,21],[70,22,62,24],[70,26,62,28],[70,27,62,29,"channel"],[70,34,62,36],[70,35,62,37,"_replyEventName"],[70,50,62,52],[70,51,62,53],[70,55,62,57],[70,56,62,58,"ref"],[70,59,62,61],[70,60,62,62],[71,6,63,8],[71,12,63,14,"callback"],[71,20,63,22],[71,23,63,26,"payload"],[71,30,63,33],[71,34,63,38],[72,8,64,12],[72,12,64,16],[72,13,64,17,"_cancelRefEvent"],[72,28,64,32],[72,29,64,33],[72,30,64,34],[73,8,65,12],[73,12,65,16],[73,13,65,17,"_cancelTimeout"],[73,27,65,31],[73,28,65,32],[73,29,65,33],[74,8,66,12],[74,12,66,16],[74,13,66,17,"receivedResp"],[74,25,66,29],[74,28,66,32,"payload"],[74,35,66,39],[75,8,67,12],[75,12,67,16],[75,13,67,17,"_matchReceive"],[75,26,67,30],[75,27,67,31,"payload"],[75,34,67,38],[75,35,67,39],[76,6,68,8],[76,7,68,9],[77,6,69,8],[77,10,69,12],[77,11,69,13,"channel"],[77,18,69,20],[77,19,69,21,"_on"],[77,22,69,24],[77,23,69,25],[77,27,69,29],[77,28,69,30,"refEvent"],[77,36,69,38],[77,38,69,40],[77,39,69,41],[77,40,69,42],[77,42,69,44,"callback"],[77,50,69,52],[77,51,69,53],[78,6,70,8],[78,10,70,12],[78,11,70,13,"timeoutTimer"],[78,23,70,25],[78,26,70,28,"setTimeout"],[78,36,70,38],[78,37,70,39],[78,43,70,45],[79,8,71,12],[79,12,71,16],[79,13,71,17,"trigger"],[79,20,71,24],[79,21,71,25],[79,30,71,34],[79,32,71,36],[79,33,71,37],[79,34,71,38],[79,35,71,39],[80,6,72,8],[80,7,72,9],[80,9,72,11],[80,13,72,15],[80,14,72,16,"timeout"],[80,21,72,23],[80,22,72,24],[81,4,73,4],[82,4,74,4,"trigger"],[82,11,74,11,"trigger"],[82,12,74,12,"status"],[82,18,74,18],[82,20,74,20,"response"],[82,28,74,28],[82,30,74,30],[83,6,75,8],[83,10,75,12],[83,14,75,16],[83,15,75,17,"refEvent"],[83,23,75,25],[83,25,76,12],[83,29,76,16],[83,30,76,17,"channel"],[83,37,76,24],[83,38,76,25,"_trigger"],[83,46,76,33],[83,47,76,34],[83,51,76,38],[83,52,76,39,"refEvent"],[83,60,76,47],[83,62,76,49],[84,8,76,51,"status"],[84,14,76,57],[85,8,76,59,"response"],[86,6,76,68],[86,7,76,69],[86,8,76,70],[87,4,77,4],[88,4,78,4,"destroy"],[88,11,78,11,"destroy"],[88,12,78,11],[88,14,78,14],[89,6,79,8],[89,10,79,12],[89,11,79,13,"_cancelRefEvent"],[89,26,79,28],[89,27,79,29],[89,28,79,30],[90,6,80,8],[90,10,80,12],[90,11,80,13,"_cancelTimeout"],[90,25,80,27],[90,26,80,28],[90,27,80,29],[91,4,81,4],[92,4,82,4,"_cancelRefEvent"],[92,19,82,19,"_cancelRefEvent"],[92,20,82,19],[92,22,82,22],[93,6,83,8],[93,10,83,12],[93,11,83,13],[93,15,83,17],[93,16,83,18,"refEvent"],[93,24,83,26],[93,26,83,28],[94,8,84,12],[95,6,85,8],[96,6,86,8],[96,10,86,12],[96,11,86,13,"channel"],[96,18,86,20],[96,19,86,21,"_off"],[96,23,86,25],[96,24,86,26],[96,28,86,30],[96,29,86,31,"refEvent"],[96,37,86,39],[96,39,86,41],[96,40,86,42],[96,41,86,43],[96,42,86,44],[97,4,87,4],[98,4,88,4,"_cancelTimeout"],[98,18,88,18,"_cancelTimeout"],[98,19,88,18],[98,21,88,21],[99,6,89,8,"clearTimeout"],[99,18,89,20],[99,19,89,21],[99,23,89,25],[99,24,89,26,"timeoutTimer"],[99,36,89,38],[99,37,89,39],[100,6,90,8],[100,10,90,12],[100,11,90,13,"timeoutTimer"],[100,23,90,25],[100,26,90,28,"undefined"],[100,35,90,37],[101,4,91,4],[102,4,92,4,"_matchReceive"],[102,17,92,17,"_matchReceive"],[102,18,92,18],[103,6,92,20,"status"],[103,12,92,26],[104,6,92,28,"response"],[105,4,92,37],[105,5,92,38],[105,7,92,40],[106,6,93,8],[106,10,93,12],[106,11,93,13,"recHooks"],[106,19,93,21],[106,20,93,22,"filter"],[106,26,93,28],[106,27,93,30,"h"],[106,28,93,31],[106,32,93,36,"h"],[106,33,93,37],[106,34,93,38,"status"],[106,40,93,44],[106,45,93,49,"status"],[106,51,93,55],[106,52,93,56],[106,53,93,57,"forEach"],[106,60,93,64],[106,61,93,66,"h"],[106,62,93,67],[106,66,93,72,"h"],[106,67,93,73],[106,68,93,74,"callback"],[106,76,93,82],[106,77,93,83,"response"],[106,85,93,91],[106,86,93,92],[106,87,93,93],[107,4,94,4],[108,4,95,4,"_hasReceived"],[108,16,95,16,"_hasReceived"],[108,17,95,17,"status"],[108,23,95,23],[108,25,95,25],[109,6,96,8],[109,13,96,15],[109,17,96,19],[109,18,96,20,"receivedResp"],[109,30,96,32],[109,34,96,36],[109,38,96,40],[109,39,96,41,"receivedResp"],[109,51,96,53],[109,52,96,54,"status"],[109,58,96,60],[109,63,96,65,"status"],[109,69,96,71],[110,4,97,4],[111,2,98,0],[112,2,98,1,"exports"],[112,9,98,1],[112,10,98,1,"default"],[112,17,98,1],[112,20,98,1,"Push"],[112,24,98,1],[113,0,98,1],[113,3]],"functionMap":{"names":["<global>","Push","Push#constructor","Push#resend","Push#send","Push#updatePayload","Push#receive","Push#startTimeout","callback","setTimeout$argument_0","Push#trigger","Push#destroy","Push#_cancelRefEvent","Push#_cancelTimeout","Push#_matchReceive","recHooks.filter$argument_0","recHooks.filter.forEach$argument_0","Push#_hasReceived"],"mappings":"AAA;eCC;ICS;KDW;IEC;KFQ;IGC;KHa;IIC;KJE;IKC;KLO;IMC;yBCM;SDK;uCEE;SFE;KNC;ISC;KTG;IUC;KVG;IWC;KXK;IYC;KZG;IaC;6BCC,0BD,UE,2BF;KbC;IgBC;KhBE;CDC"}},"type":"js/module"}]}